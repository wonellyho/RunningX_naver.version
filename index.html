

<!-- 

 <!DOCTYPE html>
 <html lang="en">
 <head>
     <script type="text/javascript" 
         src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Nearby Convenience Stores</title>
 </head>
 <body>
     <div id="map" style="width:100%; height:800px;"></div>
     <script>
         // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™”
         var map = new naver.maps.Map('map', {
             center: new naver.maps.LatLng(37.5112, 127.0981), // ê¸°ë³¸ ìœ„ì¹˜ (ì ì‹¤ ë¡¯ë°ì›”ë“œ)
             zoom: 15
         });
 
         // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
         var userMarker = new naver.maps.Marker({
             position: map.getCenter(),
             map: map,
             title: "ë‚´ ìœ„ì¹˜"
         });
 
         // ì‚¬ìš©ì ìœ„ì¹˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
         function updateLocation() {
             if (navigator.geolocation) {
                 navigator.geolocation.getCurrentPosition(
                     function (position) {
                         var lat = position.coords.latitude;
                         var lng = position.coords.longitude;
 
                         var userLatLng = new naver.maps.LatLng(lat, lng);
 
                         // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                         map.setCenter(userLatLng);
 
                         // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
                         userMarker.setPosition(userLatLng);
 
                         // ì£¼ë³€ í¸ì˜ì  ê²€ìƒ‰
                         searchNearbyConvenienceStores(userLatLng);
 
                         console.log(`í˜„ì¬ ìœ„ì¹˜: ìœ„ë„(${lat}), ê²½ë„(${lng})`);
                     },
                     function (error) {
                         console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error);
                     },
                     {
                         enableHighAccuracy: true,
                         maximumAge: 0,
                         timeout: 10000
                     }
                 );
             } else {
                 alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
             }
         }
 
         // ì£¼ë³€ í¸ì˜ì  ê²€ìƒ‰ í•¨ìˆ˜
         function searchNearbyConvenienceStores(location) {
             naver.maps.Service.geocode({
                 query: "í¸ì˜ì " // í‚¤ì›Œë“œë¡œ í¸ì˜ì  ê²€ìƒ‰
             }, function(status, response) {
                 if (status === naver.maps.Service.Status.OK) {
                     console.log("ê²€ìƒ‰ ê²°ê³¼: ", response);
                     response.result.items.forEach(function(item) {
                         new naver.maps.Marker({
                             position: new naver.maps.LatLng(item.point.y, item.point.x),
                             map: map,
                             title: item.title
                         });
                     });
                 } else {
                     console.error("ê²€ìƒ‰ ì‹¤íŒ¨: ", status);
                 }
             });
         }
 
         // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (5ì´ˆë§ˆë‹¤)
         setInterval(updateLocation, 5000);
 
         // ì´ˆê¸° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
         updateLocation();
     </script>
 </body>
 </html>


 -->

<!-- 
í™”ì¥ì‹¤ì •ë³´ë¶™ì—¬ë³´ê¸°
<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" 
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearby Public Toilets</title>
</head>
<body>
    <div id="map" style="width:100%; height:800px;"></div>
    <script>
        // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™”
        var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.5112, 127.0981), // ê¸°ë³¸ ìœ„ì¹˜ (ì ì‹¤ ë¡¯ë°ì›”ë“œ)
            zoom: 15
        });

        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
        var userMarker = new naver.maps.Marker({
            position: map.getCenter(),
            map: map,
            title: "ë‚´ ìœ„ì¹˜"
        });

        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (ìœ„ë„ì™€ ê²½ë„ë¥¼ ì‚¬ìš©)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI / 180;
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lng2 - lng1) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                    Math.cos(Ï†1) * Math.cos(Ï†2) *
                    Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const distance = R * c; // ê±°ë¦¬ (ë¯¸í„°)
            return distance;
        }

        // í™”ì¥ì‹¤ ë°ì´í„°ë¥¼ JSONì—ì„œ ë¡œë“œí•˜ì—¬ ë§ˆì»¤ë¡œ í‘œì‹œ
        function loadToiletMarkers(userLatLng) {
            fetch('toilets.json') // JSON íŒŒì¼ ë¡œë“œ
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json(); // JSON ë°ì´í„° íŒŒì‹±
                })
                .then(data => {
                    console.log("JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ! ë°ì´í„° í™•ì¸:");
                    console.log(data); // ë¶ˆëŸ¬ì˜¨ JSON ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ì—¬ í™•ì¸

                    // ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
                    data.forEach((toilet, index) => {
                        const lat = parseFloat(toilet.latitude); // ìœ„ë„
                        const lng = parseFloat(toilet.longitude); // ê²½ë„
                        const toiletName = toilet.name || "ê³µì¤‘í™”ì¥ì‹¤"; // í™”ì¥ì‹¤ ì´ë¦„

                        console.log(`ë§ˆì»¤ ë°ì´í„°: ì´ë¦„=${toiletName}, ìœ„ë„=${lat}, ê²½ë„=${lng}`);

                        // ìœ„ë„ì™€ ê²½ë„ê°€ ìœ íš¨í•˜ë©´ ë§ˆì»¤ ì¶”ê°€
                        if (!isNaN(lat) && !isNaN(lng)) {
                            const distance = calculateDistance(
                                userLatLng.lat(), 
                                userLatLng.lng(), 
                                lat, 
                                lng
                            );

                            // ë°˜ê²½ 1km ì´ë‚´ì˜ í™”ì¥ì‹¤ë§Œ í‘œì‹œ
                            if (distance <= 1000) {
                                new naver.maps.Marker({
                                    position: new naver.maps.LatLng(lat, lng),
                                    map: map,
                                    title: toiletName
                                });
                            } else {
                                console.warn(`ë°˜ê²½ì„ ë²—ì–´ë‚œ ë§ˆì»¤: ì´ë¦„=${toiletName}, ê±°ë¦¬=${distance}m`);
                            }
                        } else {
                            console.error(`ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°: ì´ë¦„=${toiletName}, ìœ„ë„=${lat}, ê²½ë„=${lng}`);
                        }
                    });
                })
                .catch(error => {
                    console.error("JSON ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                });
        }

        // ì‚¬ìš©ì ìœ„ì¹˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;

                        var userLatLng = new naver.maps.LatLng(lat, lng);

                        // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                        map.setCenter(userLatLng);

                        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
                        userMarker.setPosition(userLatLng);

                        // ì£¼ë³€ í™”ì¥ì‹¤ ë§ˆì»¤ ë¡œë“œ
                        loadToiletMarkers(userLatLng);

                        console.log(`í˜„ì¬ ìœ„ì¹˜: ìœ„ë„(${lat}), ê²½ë„(${lng})`);
                    },
                    function (error) {
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error);
                    },
                    {
                        enableHighAccuracy: false,
                        maximumAge: 0,
                        timeout: 30000
                    }
                );
            } else {
                alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }

        // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (5ì´ˆë§ˆë‹¤)
        setInterval(updateLocation, 5000);

        // ì´ˆê¸° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        updateLocation();
    </script>
</body>
</html>

-->



<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" 
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearby Public Toilets</title>
</head>
<body>
    <div id="map" style="width:100%; height:800px;"></div>
    <script>
        // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™”
        var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.5665, 126.9780), // ê¸°ë³¸ ìœ„ì¹˜ (ì„œìš¸ ì‹œì²­)
            zoom: 15
        });

        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
        var userMarker = new naver.maps.Marker({
            position: map.getCenter(),
            map: map,
            title: "ë‚´ ìœ„ì¹˜"
        });

        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (ìœ„ë„ì™€ ê²½ë„ë¥¼ ì‚¬ìš©)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI / 180;
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lng2 - lng1) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const distance = R * c; // ê±°ë¦¬ (ë¯¸í„°)
            return distance;
        }

        function loadToiletMarkers(userLatLng) {
            fetch('toilets_cleaned.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("JSON ë°ì´í„° ë¡œë“œ ì„±ê³µ:", data);
        
                    // ë°˜ê²½ 5km ì´ë‚´ ë°ì´í„°ë§Œ í•„í„°ë§
                    const filteredData = data.filter((toilet) => {
                        const { latitude, longitude } = toilet;
                        if (latitude === null || longitude === null) {
                            return false; // ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° ì œì™¸
                        }
        
                        const distance = calculateDistance(
                            userLatLng.lat(),
                            userLatLng.lng(),
                            latitude,
                            longitude
                        );
        
                        return distance <= 5000; // ë°˜ê²½ 5km ì´ë‚´ë§Œ í¬í•¨
                    });
        
                    // í•„í„°ë§ëœ ë°ì´í„°ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œ
                    filteredData.forEach((toilet) => {
                        const { name, latitude, longitude } = toilet;
        
                        new naver.maps.Marker({
                            position: new naver.maps.LatLng(latitude, longitude),
                            map: map,
                            title: name
                        });
        
                        console.log(`ë§ˆì»¤ ì¶”ê°€ë¨: ì´ë¦„=${name}, ìœ„ë„=${latitude}, ê²½ë„=${longitude}`);
                    });
                })
                .catch(error => {
                    console.error("JSON ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                });
        }

        // ì‚¬ìš©ì ìœ„ì¹˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;

                        var userLatLng = new naver.maps.LatLng(lat, lng);

                        // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                        map.setCenter(userLatLng);

                        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
                        userMarker.setPosition(userLatLng);

                        // ì£¼ë³€ í™”ì¥ì‹¤ ë§ˆì»¤ ë¡œë“œ
                        loadToiletMarkers(userLatLng);

                        console.log(`í˜„ì¬ ìœ„ì¹˜: ìœ„ë„(${lat}), ê²½ë„(${lng})`);
                    },
                    function (error) {
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", error);
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 0,
                        timeout: 10000 // íƒ€ì„ì•„ì›ƒ ì¦ê°€
                    }
                );
            } else {
                alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }

        // ì´ˆê¸° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        updateLocation();
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
    <meta charset="UTF-8">
    <title>ê²½ë¡œ ì•ˆë‚´</title>
</head>
<body>
    <div id="map" style="width:100%; height:800px;"></div>
    <script>
        // ì§€ë„ ì´ˆê¸°í™”
        var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.359708, 127.1058342), // ì¶œë°œì§€ ì¢Œí‘œ
            zoom: 8
        });

        // Directions API í˜¸ì¶œ
        function getDirections(startLat, startLng, goalLat, goalLng) {
            const url = `https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving?start=${startLng},${startLat}&goal=${goalLng},${goalLat}`;
            const headers = {
                "X-NCP-APIGW-API-KEY-ID": "h2d8vaz3os",
                "X-NCP-APIGW-API-KEY": "7b3UMnE0ex4wKT4zkcOMKsAoOqN616YIoLeLd3nP"
            };

            fetch(url, { headers })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 0) { // ì„±ê³µ ì½”ë“œ í™•ì¸
                        const route = data.route.traoptimal[0];
                        const path = route.path.map(coord => new naver.maps.LatLng(coord[1], coord[0])); // ê²½ë¡œ ì¢Œí‘œ ë³€í™˜

                        // ì§€ë„ì— ê²½ë¡œ í‘œì‹œ
                        new naver.maps.Polyline({
                            map: map,
                            path: path,
                            strokeColor: '#FF0000',
                            strokeWeight: 5
                        });

                        // ì¶œë°œì§€ ë§ˆì»¤
                        new naver.maps.Marker({
                            position: path[0],
                            map: map,
                            title: "ì¶œë°œì§€"
                        });

                        // ë„ì°©ì§€ ë§ˆì»¤
                        new naver.maps.Marker({
                            position: path[path.length - 1],
                            map: map,
                            title: "ë„ì°©ì§€"
                        });
                    } else {
                        console.error("ê²½ë¡œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", data.message);
                    }
                })
                .catch(error => console.error("API ìš”ì²­ ì‹¤íŒ¨:", error));
        }

        // ì¶œë°œì§€ì™€ ë„ì°©ì§€ ì¢Œí‘œ
        const startLat = 37.359708; // ì„±ë‚¨ì‹œ ì¶œë°œì§€ ìœ„ë„
        const startLng = 127.1058342; // ì„±ë‚¨ì‹œ ì¶œë°œì§€ ê²½ë„
        const goalLat = 35.179470; // ë¶€ì‚° ë„ì°©ì§€ ìœ„ë„
        const goalLng = 129.075986; // ë¶€ì‚° ë„ì°©ì§€ ê²½ë„

        // ê²½ë¡œ í˜¸ì¶œ
        getDirections(startLat, startLng, goalLat, goalLng);
    </script>
</body>
</html> -->


<!-- <-- ì‹¤ì‹œê°„ ê²½ë¡œ ì ìš©ì „--> 

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤ ê²½ë¡œ</title>
</head>
<body>
    <div id="map" style="width:100%; height:800px;"></div>
    <script>
        // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™”
        var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.5665, 126.9780), // ê¸°ë³¸ ìœ„ì¹˜ (ì„œìš¸ ì‹œì²­)
            zoom: 15
        });

        var userMarker = new naver.maps.Marker({
            map: map,
            title: "í˜„ì¬ ìœ„ì¹˜"
        });

        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (ìœ„ë„ì™€ ê²½ë„ë¥¼ ì‚¬ìš©)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI / 180;
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lng2 - lng1) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // ê±°ë¦¬ (ë¯¸í„°)
        }

        // ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤ ì°¾ê¸°
        function findNearestToilet(userLatLng, toilets) {
            let nearestToilet = null;
            let minDistance = Infinity;

            toilets.forEach(toilet => {
                if (toilet.latitude && toilet.longitude) {
                    const distance = calculateDistance(
                        userLatLng.lat(),
                        userLatLng.lng(),
                        toilet.latitude,
                        toilet.longitude
                    );

                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestToilet = toilet;
                    }
                }
            });

            return nearestToilet;
        }

        // ê²½ë¡œë¥¼ ì§€ë„ì— í‘œì‹œ
        function showRouteToToilet(startLat, startLng, goalLat, goalLng) {
            const url = `https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving?start=${startLng},${startLat}&goal=${goalLng},${goalLat}`;
            const headers = {
                "X-NCP-APIGW-API-KEY-ID": "h2d8vaz3os",
                "X-NCP-APIGW-API-KEY": "7b3UMnE0ex4wKT4zkcOMKsAoOqN616YIoLeLd3nP"
            };

            fetch(url, { headers })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 0) {
                        const route = data.route.traoptimal[0];
                        const path = route.path.map(coord => new naver.maps.LatLng(coord[1], coord[0]));

                        // ê²½ë¡œ í‘œì‹œ
                        new naver.maps.Polyline({
                            map: map,
                            path: path,
                            strokeColor: '#FF0000',
                            strokeWeight: 5
                        });

                        // ì¶œë°œì§€ì™€ ëª©ì ì§€ì— ë§ˆì»¤ ì¶”ê°€
                        new naver.maps.Marker({
                            position: path[0],
                            map: map,
                            title: "í˜„ì¬ ìœ„ì¹˜"
                        });
                        new naver.maps.Marker({
                            position: path[path.length - 1],
                            map: map,
                            title: "ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤"
                        });
                    } else {
                        console.error("ê²½ë¡œ íƒìƒ‰ ì‹¤íŒ¨:", data.message);
                    }
                })
                .catch(error => console.error("API ìš”ì²­ ì‹¤íŒ¨:", error));
        }

        // ì‚¬ìš©ì ìœ„ì¹˜ ë° ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤ íƒìƒ‰
        function updateLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        const userLatLng = new naver.maps.LatLng(userLat, userLng);

                        // ì§€ë„ ì¤‘ì‹¬ ì´ë™ ë° í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
                        map.setCenter(userLatLng);
                        userMarker.setPosition(userLatLng);

                        // JSON íŒŒì¼ì—ì„œ í™”ì¥ì‹¤ ë°ì´í„° ë¡œë“œ
                        fetch('toilets_cleaned.json')
                            .then(response => response.json())
                            .then(data => {
                                const nearestToilet = findNearestToilet(userLatLng, data);

                                if (nearestToilet) {
                                    console.log(`ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤: ${nearestToilet.name}`);
                                    showRouteToToilet(
                                        userLat, userLng,
                                        nearestToilet.latitude, nearestToilet.longitude
                                    );
                                } else {
                                    alert("ì£¼ë³€ì— í™”ì¥ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.");
                                }
                            })
                            .catch(error => console.error("í™”ì¥ì‹¤ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error));
                    },
                    function (error) {
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    },
                    { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
                );
            } else {
                alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }

        // ì´ˆê¸° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        updateLocation();
    </script>
</body>
</html> -->



<!-- ì‹¤ì‹œê°„ ìœ„ì¹˜ë¥¼ ë°˜ì˜+ê¸¸ì°¾ê¸° ê²½ë¡œ+í™”ì¥ì‹¤ë„ì°©ì§€ ë§ˆí¬ ê³„ì†ìœ ì§€ -->
<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ê²½ë¡œ ì•ˆë‚´</title>
</head>
<body>
    <div id="map" style="width:100%; height:800px;"></div>
    <script>
        let userMarker = null; // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤
        let destinationMarker = null; // ë„ì°©ì§€ ë§ˆì»¤
        let routePolyline = null; // ê²½ë¡œë¥¼ í‘œì‹œí•  Polyline

        // ë„¤ì´ë²„ ì§€ë„ ì´ˆê¸°í™”
        const map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.5665, 126.9780), // ê¸°ë³¸ ìœ„ì¹˜ (ì„œìš¸ ì‹œì²­)
            zoom: 15
        });

        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI / 180;
            const Ï†2 = lat2 * Math.PI / 180;
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
            const Î”Î» = (lng2 - lng1) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // ê±°ë¦¬ (ë¯¸í„°)
        }

        // ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤ ì°¾ê¸°
        function findNearestToilet(userLatLng, toilets) {
            let nearestToilet = null;
            let minDistance = Infinity;

            toilets.forEach(toilet => {
                if (toilet.latitude && toilet.longitude) {
                    const distance = calculateDistance(
                        userLatLng.lat(),
                        userLatLng.lng(),
                        toilet.latitude,
                        toilet.longitude
                    );

                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestToilet = toilet;
                    }
                }
            });

            return nearestToilet;
        }

        // ê²½ë¡œë¥¼ ì§€ë„ì— í‘œì‹œ
        function showRouteToToilet(startLat, startLng, goalLat, goalLng) {
            const url = `https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving?start=${startLng},${startLat}&goal=${goalLng},${goalLat}`;
            const headers = {
                "X-NCP-APIGW-API-KEY-ID": "h2d8vaz3os",
                "X-NCP-APIGW-API-KEY": "7b3UMnE0ex4wKT4zkcOMKsAoOqN616YIoLeLd3nP"
            };

            fetch(url, { headers })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 0) {
                        const route = data.route.traoptimal[0];
                        const path = route.path.map(coord => new naver.maps.LatLng(coord[1], coord[0]));

                        // ê¸°ì¡´ ê²½ë¡œê°€ ìˆìœ¼ë©´ ì œê±°
                        if (routePolyline) {
                            routePolyline.setMap(null);
                        }

                        // ê²½ë¡œ í‘œì‹œ
                        routePolyline = new naver.maps.Polyline({
                            map: map,
                            path: path,
                            strokeColor: '#FF0000',
                            strokeWeight: 5
                        });

                        // ë„ì°©ì§€ ë§ˆì»¤ ì—…ë°ì´íŠ¸
                        const destinationLatLng = path[path.length - 1];
                        if (!destinationMarker) {
                            destinationMarker = new naver.maps.Marker({
                                map: map,
                                title: "ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤",
                                icon: {
                                    content: '<div style="color: blue;">ğŸš»</div>'
                                }
                            });
                        }
                        destinationMarker.setPosition(destinationLatLng);
                    } else {
                        console.error("ê²½ë¡œ íƒìƒ‰ ì‹¤íŒ¨:", data.message);
                    }
                })
                .catch(error => console.error("API ìš”ì²­ ì‹¤íŒ¨:", error));
        }

        // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ë° ê²½ë¡œ ê°±ì‹ 
        function watchUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    function (position) {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        const userLatLng = new naver.maps.LatLng(userLat, userLng);

                        // ì§€ë„ ì¤‘ì‹¬ ì—…ë°ì´íŠ¸
                        map.setCenter(userLatLng);

                        // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
                        if (!userMarker) {
                            userMarker = new naver.maps.Marker({
                                map: map,
                                title: "í˜„ì¬ ìœ„ì¹˜"
                            });
                        }
                        userMarker.setPosition(userLatLng);

                        // JSON íŒŒì¼ì—ì„œ í™”ì¥ì‹¤ ë°ì´í„° ë¡œë“œ
                        fetch('toilets_cleaned.json')
                            .then(response => response.json())
                            .then(data => {
                                const nearestToilet = findNearestToilet(userLatLng, data);

                                if (nearestToilet) {
                                    console.log(`ê°€ì¥ ê°€ê¹Œìš´ í™”ì¥ì‹¤: ${nearestToilet.name}`);
                                    showRouteToToilet(
                                        userLat, userLng,
                                        nearestToilet.latitude, nearestToilet.longitude
                                    );
                                } else {
                                    alert("ì£¼ë³€ì— í™”ì¥ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.");
                                }
                            })
                            .catch(error => console.error("í™”ì¥ì‹¤ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error));
                    },
                    function (error) {
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    },
                    { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
                );
            } else {
                alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }

        // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ì‹œì‘
        watchUserLocation();
    </script>
</body>
</html>


<!-- ê²€ìƒ‰í™”ì¥ì‹¤ ë¶ˆëŸ¬ì˜¤ê¸°-ì•ˆëœë‹¤.
<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h2d8vaz3os"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™”ì¥ì‹¤ ê²€ìƒ‰ ë° ê¸¸ì°¾ê¸°</title>
</head>
<body>
    <div id="map" style="width:100%; height:800px;"></div>
    <script>
        const SEARCH_API_CLIENT_ID = "ST64QkhoVBggxmUlWrLt";
        const SEARCH_API_CLIENT_SECRET = "PyWfYnbdv1";
        const NCP_API_CLIENT_ID = "h2d8vaz3os";
        const NCP_API_CLIENT_SECRET = "7b3UMnE0ex4wKT4zkcOMKsAoOqN616YIoLeLd3nP";

        let map = new naver.maps.Map("map", {
            center: new naver.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì‹œì²­
            zoom: 15
        });

        let userMarker = null;

        function updateUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        const userLatLng = new naver.maps.LatLng(userLat, userLng);

                        map.setCenter(userLatLng);

                        if (!userMarker) {
                            userMarker = new naver.maps.Marker({
                                position: userLatLng,
                                map: map,
                                title: "í˜„ì¬ ìœ„ì¹˜"
                            });
                        } else {
                            userMarker.setPosition(userLatLng);
                        }

                        searchNearbyToilets(userLat, userLng);
                    },
                    error => console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error),
                    { enableHighAccuracy: true }
                );
            } else {
                alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }

        function searchNearbyToilets(lat, lng) {
            const query = "í™”ì¥ì‹¤";
            const radius = 5000;
            const url = `https://openapi.naver.com/v1/search/local.json?query=${query}&coordinate=${lng},${lat}&radius=${radius}`;
            
            fetch(url, {
                headers: {
                    "X-Naver-Client-Id": SEARCH_API_CLIENT_ID,
                    "X-Naver-Client-Secret": SEARCH_API_CLIENT_SECRET
                }
            })
                .then(response => {
                    console.log("HTTP ìƒíƒœ ì½”ë“œ:", response.status);
                    if (!response.ok) {
                        throw new Error(`Search API í˜¸ì¶œ ì‹¤íŒ¨: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Search API ê²°ê³¼ ë°ì´í„°:", data);

                    if (data.items.length === 0) {
                        console.warn("ë°˜ê²½ ë‚´ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ");
                        return;
                    }

                    displayToiletMarkers(data.items, lat, lng);
                })
                .catch(error => {
                    console.error("Search API ìš”ì²­ ì‹¤íŒ¨:", error);
                });
        }

        function displayToiletMarkers(items, userLat, userLng) {
            items.forEach(item => {
                const mapx = parseFloat(item.mapx); // EPSG:3857 X ì¢Œí‘œ
                const mapy = parseFloat(item.mapy); // EPSG:3857 Y ì¢Œí‘œ
        
                console.log("ë³€í™˜ ì „ ì¢Œí‘œ:", mapx, mapy);
        
                // EPSG:3857 â†’ EPSG:4326 ë³€í™˜
                const { lat, lng } = convertEPSG3857ToWGS84(mapx, mapy);
                const wgs84LatLng = new naver.maps.LatLng(lat, lng);
        
                const marker = new naver.maps.Marker({
                    position: wgs84LatLng,
                    map: map,
                    title: item.title
                });
        
                // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ (ê¸¸ì°¾ê¸°)
                naver.maps.Event.addListener(marker, "click", () => {
                    findRoute(userLat, userLng, wgs84LatLng.lat(), wgs84LatLng.lng(), item.title);
                });
            });
        }

        function convertEPSG3857ToWGS84(x, y) {
            const RADIUS = 6378137; // WGS84 íƒ€ì›ì²´ ë°˜ê²½
            const lon = (x / RADIUS) * (180 / Math.PI);
            const lat = (Math.atan(Math.exp(y / RADIUS)) * 2 - Math.PI / 2) * (180 / Math.PI);
            return { lat, lng: lon };
        }

        function findRoute(startLat, startLng, goalLat, goalLng, placeName) {
            const url = `https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving?start=${startLng},${startLat}&goal=${goalLng},${goalLat}`;

            fetch(url, {
                headers: {
                    "X-NCP-APIGW-API-KEY-ID": NCP_API_CLIENT_ID,
                    "X-NCP-APIGW-API-KEY": NCP_API_CLIENT_SECRET
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 0) {
                        const route = data.route.traoptimal[0];
                        const path = route.path.map(coord => new naver.maps.LatLng(coord[1], coord[0]));

                        new naver.maps.Polyline({
                            map: map,
                            path: path,
                            strokeColor: '#FF0000',
                            strokeWeight: 5
                        });

                        map.setCenter(new naver.maps.LatLng(goalLat, goalLng));
                        alert(`ê¸¸ì°¾ê¸° ì•ˆë‚´: ${placeName}`);
                    } else {
                        console.error("ê¸¸ì°¾ê¸° ì‹¤íŒ¨:", data.message);
                    }
                })
                .catch(error => console.error("ê¸¸ì°¾ê¸° ìš”ì²­ ì‹¤íŒ¨:", error));
        }

        updateUserLocation();
    </script>
</body>
</html> -->
